# ğŸ—ï¸ COMET-AI â€” Technical Architecture & Data Flows

## System Architecture Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER INTERFACE LAYER                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Desktop (Electron + React) â”‚      â”‚  Mobile (Flutter)    â”‚    â”‚
â”‚  â”‚  â”œâ”€ Browser UI              â”‚      â”‚  â”œâ”€ Chat Interface   â”‚    â”‚
â”‚  â”‚  â”œâ”€ Settings Panel          â”‚      â”‚  â”œâ”€ Desktop Control  â”‚    â”‚
â”‚  â”‚  â”œâ”€ Plugin Manager          â”‚      â”‚  â”œâ”€ Screen View      â”‚    â”‚
â”‚  â”‚  â”œâ”€ Download Manager        â”‚      â”‚  â””â”€ Sync UI          â”‚    â”‚
â”‚  â”‚  â””â”€ AI Chat Sidebar         â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚            â†• (IPC Events)              â†• (WebSocket)              â”‚
â”‚                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    APPLICATION LOGIC LAYER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  ELECTRON MAIN PROCESS                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Core Services                                              â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚  â”‚
â”‚  â”‚  â”‚  AI Engine       â”‚  â”‚  Security Layer  â”‚               â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Chat         â”‚  â”‚  â”œâ”€ Permission   â”‚               â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Reasoning    â”‚  â”‚  â”‚   Store       â”‚               â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Streaming    â”‚  â”‚  â”œâ”€ Audit Log    â”‚               â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€ Encryption   â”‚               â”‚  â”‚
â”‚  â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚  â”‚
â”‚  â”‚  â”‚  Desktop Control â”‚  â”‚  Data Services   â”‚               â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ RobotJS      â”‚  â”‚  â”œâ”€ FileSystem   â”‚               â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ OCR Engine   â”‚  â”‚  â”œâ”€ SQLite DB    â”‚               â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Screen Caps  â”‚  â”‚  â”œâ”€ LanceDB RAG  â”‚               â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Voice Input  â”‚  â”‚  â””â”€ Web Search   â”‚               â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚  â”‚
â”‚  â”‚  â”‚  MCP Servers     â”‚  â”‚  Bridge Services â”‚               â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ FileSystem   â”‚  â”‚  â”œâ”€ Flutter WS   â”‚               â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ NativeApp    â”‚  â”‚  â”œâ”€ Global Hotkeyâ”‚               â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Screen CTX   â”‚  â”‚  â””â”€ Notificationsâ”‚               â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Integrations â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â†• (IPC Handlers)                                        â”‚
â”‚                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     SYSTEM INTEGRATION LAYER                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  NATIVE APIs & EXTERNAL SERVICES                                   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Electron Native  â”‚  â”‚ AI Services      â”‚  â”‚ External APIs â”‚   â”‚
â”‚  â”‚ â”œâ”€ Desktop       â”‚  â”‚ â”œâ”€ Google Gemini â”‚  â”‚ â”œâ”€ Gmail      â”‚   â”‚
â”‚  â”‚ â”‚  Capturer      â”‚  â”‚ â”œâ”€ Groq Llama    â”‚  â”‚ â”œâ”€ GitHub     â”‚   â”‚
â”‚  â”‚ â”œâ”€ Menu/Dock     â”‚  â”‚ â”œâ”€ OpenAI GPT    â”‚  â”‚ â”œâ”€ Slack      â”‚   â”‚
â”‚  â”‚ â”œâ”€ Dialog/Menu   â”‚  â”‚ â”œâ”€ Claude API    â”‚  â”‚ â”œâ”€ Notion     â”‚   â”‚
â”‚  â”‚ â”œâ”€ Tray Icon     â”‚  â”‚ â””â”€ Whisper API   â”‚  â”‚ â””â”€ Web Search â”‚   â”‚
â”‚  â”‚ â””â”€ Shell Exec    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ OS Level         â”‚  â”‚ Databases        â”‚                        â”‚
â”‚  â”‚ â”œâ”€ RobotJS       â”‚  â”‚ â”œâ”€ SQLite        â”‚                        â”‚
â”‚  â”‚ â”œâ”€ Tesseract     â”‚  â”‚ â”‚  (history,     â”‚                        â”‚
â”‚  â”‚ â”‚  WASM          â”‚  â”‚ â”‚   bookmarks,   â”‚                        â”‚
â”‚  â”‚ â”œâ”€ System Tray   â”‚  â”‚ â”‚   settings)    â”‚                        â”‚
â”‚  â”‚ â”œâ”€ File System   â”‚  â”‚ â”œâ”€ LanceDB       â”‚                        â”‚
â”‚  â”‚ â””â”€ Keyboard      â”‚  â”‚ â”‚  (vector RAG)  â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â””â”€ Keychain      â”‚                        â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: "Click the Pay Button"

```
USER SPEAKS/TYPES: "Click the Pay button"
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. PARSE INTENT (React Component)                            â”‚
â”‚    â””â”€ Detect command: robot action (click)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ IPC: invoke('ai:command', { message })
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. CLASSIFY RISK (Security Layer)                            â”‚
â”‚    â””â”€ Risk = WRITE (modifies page state)                    â”‚
â”‚    â””â”€ Requires: permission check + user confirm              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. CHECK PERMISSIONS (PermissionStore)                       â”‚
â”‚    â””â”€ Query SQLite: SELECT * FROM permissions               â”‚
â”‚        WHERE key='robot' AND expires_at > NOW()              â”‚
â”‚    â””â”€ Result: GRANTED (session expires 8h)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ If DENIED â†’ throw error, return to user
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. CAPTURE SCREEN & OCR (Tesseract Service)                 â”‚
â”‚    â””â”€ desktopCapturer.getSources() â†’ PNG thumbnail           â”‚
â”‚    â””â”€ sharp: grayscale â†’ normalize â†’ sharpen â†’ upscale      â”‚
â”‚    â””â”€ tesseract.worker.recognize() â†’ word list              â”‚
â”‚    â””â”€ Filter words: confidence > 60                          â”‚
â”‚    â””â”€ Return: [{text:"Pay",center:(923,442)}, ...]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. RESOLVE TARGET (AI Engine)                                â”‚
â”‚    â””â”€ Direct match: "pay" in word list? YES â†’ use directly   â”‚
â”‚    â””â”€ Or: LLM query "which word matches 'Pay button'?"      â”‚
â”‚    â””â”€ Result: target = {x:923, y:442}                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ IPC: showConfirmDialog()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. SHOW USER CONFIRMATION                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚    â”‚ Confirm Action                  â”‚                       â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚                       â”‚
â”‚    â”‚ Click 'Pay' at (923, 442)       â”‚                       â”‚
â”‚    â”‚ in Google Chrome                â”‚                       â”‚
â”‚    â”‚                                 â”‚                       â”‚
â”‚    â”‚ [ Approve ]  [ Deny ]           â”‚                       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚    â””â”€ Wait for user response (max 10s timeout)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ User clicks "Approve"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. VALIDATE COORDINATES (RobotService)                       â”‚
â”‚    â””â”€ Check: (923,442) within display bounds?               â”‚
â”‚    â””â”€ Check: time since last action >= 300ms?               â”‚
â”‚    â””â”€ Result: VALID â†’ proceed                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. EXECUTE ROBOT ACTION (RobotJS)                            â”‚
â”‚    â””â”€ robot.moveMouse(923, 442)   // 80ms delay             â”‚
â”‚    â””â”€ robot.mouseClick('left')                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. AUDIT LOG (SecurityService)                               â”‚
â”‚    â””â”€ INSERT INTO audit_log:                                â”‚
â”‚        {                                                     â”‚
â”‚          action: 'robot.click',                             â”‚
â”‚          reason: 'User command: click pay button',          â”‚
â”‚          coords: '923,442',                                 â”‚
â”‚          target_app: 'Google Chrome',                       â”‚
â”‚          timestamp: 1708945232000,                          â”‚
â”‚          user_approved: true                                â”‚
â”‚        }                                                     â”‚
â”‚    â””â”€ HMAC sign entry with encryption key                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. RETURN RESULT TO UI                                      â”‚
â”‚     â””â”€ {success: true, clickedText: "Pay"}                  â”‚
â”‚     â””â”€ Show "Action completed" message in sidebar           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TOTAL LATENCY: ~2-3 seconds
 â€¢ Screenshot capture: 200ms
 â€¢ OCR: 800ms
 â€¢ LLM target resolution: 400ms (or 0ms if direct match)
 â€¢ User confirmation: variable (instant with trust, or delayed)
 â€¢ RobotJS execution: <100ms
 â€¢ Audit log: 50ms
```

---

## Data Flow: "Search for AI trends"

```
USER TYPES: "Search for AI trends 2026"
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. PARSE INTENT (LLM)                                        â”‚
â”‚    â””â”€ Model: groq/llama-3.1-8b-instant                      â”‚
â”‚    â””â”€ Prompt: "Is this a web search? Yes/No"               â”‚
â”‚    â””â”€ Result: SEARCH action detected                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. RETRIEVE CONTEXT (RAG Service)                            â”‚
â”‚    â””â”€ LanceDB vector search:                                â”‚
â”‚        SELECT * FROM chunks                                 â”‚
â”‚        WHERE vector_distance(embed(query), vector) < 0.8    â”‚
â”‚        LIMIT 4                                              â”‚
â”‚    â””â”€ Returns: [doc1, doc2, doc3, doc4]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. WEB SEARCH (WebSearchService)                             â”‚
â”‚    â””â”€ Provider: Brave (privacy-first)                       â”‚
â”‚    â””â”€ POST https://api.search.brave.com/res/v1/web/search  â”‚
â”‚    â”‚  params: {q: "AI trends 2026", count: 8}              â”‚
â”‚    â””â”€ Returns: [{title, url, snippet}, ...]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. LLM SYNTHESIS (AI Engine - streaming)                    â”‚
â”‚    â””â”€ Model: gemini-2.5-flash (fast)                       â”‚
â”‚    â””â”€ System prompt: "Summarize AI trends based on..."      â”‚
â”‚    â”‚  systemPrompt                                          â”‚
â”‚    â”‚  â”œâ”€ RAG context from LanceDB                          â”‚
â”‚    â”‚  â”œâ”€ Web search results                                â”‚
â”‚    â”‚  â””â”€ Chat history                                      â”‚
â”‚    â””â”€ Stream response to sidebar in real-time               â”‚
â”‚    â””â”€ Example: "Here are the top AI trends in 2026:        â”‚
â”‚                 1. Multimodal models are becoming standard... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. DISPLAY + OFFER FOLLOW-UPS                               â”‚
â”‚    â””â”€ Show response in chat sidebar                        â”‚
â”‚    â””â”€ Add buttons: [More details] [Read full articles]     â”‚
â”‚    â””â”€ Allow follow-up: "Tell me more about..."             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TOTAL LATENCY: ~3-4 seconds
 â€¢ Intent parse: 200ms
 â€¢ RAG retrieval: 100ms
 â€¢ Web search: 1500ms
 â€¢ LLM streaming: 1200ms
 â€¢ Render: 50ms
```

---

## Data Flow: Flutter â†” Desktop Bridge

```
MOBILE USER: "Click the submit button on my desktop"
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Flutter App (Mobile)                         â”‚
â”‚ socket.emit('ocr:click', {target: "submit"}) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ WebSocket @ 127.0.0.1:9876
    â”‚ (authenticated with rotating HMAC secret)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Electron Bridge Server (Desktop)             â”‚
â”‚ socket.on('ocr:click')                       â”‚
â”‚ â”œâ”€ Validate auth token (HMAC check)          â”‚
â”‚ â”œâ”€ Check device_id registered                â”‚
â”‚ â””â”€ Dispatch to TesseractOcrService           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OCR Click Engine                             â”‚
â”‚ â”œâ”€ captureAndOcr()                           â”‚
â”‚ â”œâ”€ Find "submit" in words                    â”‚
â”‚ â”œâ”€ Show confirmation dialog                  â”‚
â”‚ â”‚  "Mobile device requesting: Click 'submit'"â”‚
â”‚ â”œâ”€ User approves                             â”‚
â”‚ â””â”€ robot.mouseClick(x, y)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ WebSocket response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Flutter App Receives                         â”‚
â”‚ socket.on('ocr:result', {success, text})     â”‚
â”‚ â””â”€ Display: "Clicked 'submit' button"        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

BRIDGE SECURITY:
 â€¢ Server bound to 127.0.0.1 (localhost ONLY)
 â€¢ Flutter app connects over local Wi-Fi
 â€¢ Auth: HMAC shared secret (rotated each app launch)
 â€¢ Displayed as QR code for easy pairing
 â€¢ All actions logged + confirmed
```

---

## Component Interaction Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ELECTRON COMPONENTS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  main.ts (Entry Point)                                           â”‚
â”‚  â””â”€ Initializes:                                                 â”‚
â”‚     â”œâ”€ CometAiEngine (LLMs)                                     â”‚
â”‚     â”œâ”€ TesseractOcrService (OCR)                                â”‚
â”‚     â”œâ”€ RobotService (Desktop automation)                        â”‚
â”‚     â”œâ”€ WebSearchService (web search)                            â”‚
â”‚     â”œâ”€ RagService (LanceDB)                                     â”‚
â”‚     â”œâ”€ PermissionStore (SQLite permissions)                     â”‚
â”‚     â”œâ”€ CometSecurityService (audit log)                         â”‚
â”‚     â”œâ”€ FlutterBridgeServer (WebSocket)                          â”‚
â”‚     â”œâ”€ WorkflowRecorder (automation)                            â”‚
â”‚     â”œâ”€ VoiceService (Whisper transcription)                     â”‚
â”‚     â”œâ”€ ScreenVisionService (Claude vision)                      â”‚
â”‚     â””â”€ MCP Servers (FileSystem, NativeApp, etc.)                â”‚
â”‚                                                                   â”‚
â”‚  IPC Handlers (preload.js â†” main.ts)                            â”‚
â”‚  â”œâ”€ ai:chat                â†’ CometAiEngine.chat()               â”‚
â”‚  â”œâ”€ ocr:click             â†’ TesseractOcrService.ocrClick()      â”‚
â”‚  â”œâ”€ robot:execute         â†’ RobotService.execute()              â”‚
â”‚  â”œâ”€ web:search            â†’ WebSearchService.search()           â”‚
â”‚  â”œâ”€ screen:capture        â†’ desktopCapturer.getSources()        â”‚
â”‚  â”œâ”€ voice:transcribe      â†’ VoiceService.transcribeFile()       â”‚
â”‚  â”œâ”€ screen:describe       â†’ ScreenVisionService.describe()      â”‚
â”‚  â”œâ”€ workflow:record       â†’ WorkflowRecorder.record()           â”‚
â”‚  â”œâ”€ workflow:replay       â†’ WorkflowRecorder.replay()           â”‚
â”‚  â”œâ”€ permission:check      â†’ PermissionStore.isGranted()         â”‚
â”‚  â”œâ”€ permission:grant      â†’ PermissionStore.grant()             â”‚
â”‚  â”œâ”€ mcp:execute           â†’ McpServer.execute()                 â”‚
â”‚  â””â”€ security:audit        â†’ CometSecurityService.log()          â”‚
â”‚                                                                   â”‚
â”‚  Preload Script (preload.js)                                     â”‚
â”‚  â””â”€ Exposes to renderer:                                         â”‚
â”‚     â”œâ”€ cometBridge (safe APIs)                                  â”‚
â”‚     â”‚  â”œâ”€ chat()                                                â”‚
â”‚     â”‚  â”œâ”€ ocrClick()                                            â”‚
â”‚     â”‚  â”œâ”€ captureScreen()                                       â”‚
â”‚     â”‚  â”œâ”€ listApps()                                            â”‚
â”‚     â”‚  â”œâ”€ openApp()                                             â”‚
â”‚     â”‚  â”œâ”€ searchWeb()                                           â”‚
â”‚     â”‚  â”œâ”€ transcribeVoice()                                     â”‚
â”‚     â”‚  â””â”€ playNotification()                                    â”‚
â”‚     â””â”€ electronAPI (limited Electron APIs)                      â”‚
â”‚        â”œâ”€ openExternal(url)                                     â”‚
â”‚        â”œâ”€ showNotification(options)                             â”‚
â”‚        â””â”€ getAppVersion()                                       â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Permission Gate Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PERMISSION STORE (SQLite)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  TABLE: permissions                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ key    â”‚ level    â”‚ granted_at â”‚ expires_ â”‚ desc   â”‚  â”‚
â”‚  â”‚        â”‚          â”‚            â”‚ at       â”‚        â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚'robot' â”‚'interact'â”‚1708945200  â”‚1708976..â”‚'UI   â”‚  â”‚
â”‚  â”‚'ai'    â”‚'write'   â”‚1708945200  â”‚null     â”‚'Perm'â”‚  â”‚
â”‚  â”‚'mcp'   â”‚'execute' â”‚1708945200  â”‚1708976..â”‚'MCP' â”‚  â”‚
â”‚  â”‚'voice' â”‚'read'    â”‚1708945200  â”‚null     â”‚'Mic' â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                            â”‚
â”‚  TABLE: audit_log                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚id  â”‚action_type â”‚timestamp â”‚reason    â”‚confirmed  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚1   â”‚robot.click â”‚1708945..â”‚Click pay â”‚true       â”‚   â”‚
â”‚  â”‚2   â”‚ai.chat     â”‚1708945..â”‚Search    â”‚true       â”‚   â”‚
â”‚  â”‚3   â”‚robot.type  â”‚1708945..â”‚Type text â”‚true       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                            â”‚
â”‚  Permission Check Flow:                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 1. User requests action (e.g., click button)  â”‚      â”‚
â”‚  â”‚    â†“                                            â”‚      â”‚
â”‚  â”‚ 2. CometSecurityService.classify() â†’ risk    â”‚      â”‚
â”‚  â”‚    â†“                                            â”‚      â”‚
â”‚  â”‚ 3. PermissionStore.isGranted('robot') check   â”‚      â”‚
â”‚  â”‚    - Get row from SQLite                       â”‚      â”‚
â”‚  â”‚    - Check if expires_at > NOW()               â”‚      â”‚
â”‚  â”‚    - If expired: DELETE row, return false      â”‚      â”‚
â”‚  â”‚    â†“                                            â”‚      â”‚
â”‚  â”‚ 4. If false â†’ Deny, ask user to enable        â”‚      â”‚
â”‚  â”‚    If true  â†’ Show confirmation dialog         â”‚      â”‚
â”‚  â”‚    â†“                                            â”‚      â”‚
â”‚  â”‚ 5. User approves â†’ Execute action              â”‚      â”‚
â”‚  â”‚    â†“                                            â”‚      â”‚
â”‚  â”‚ 6. Log to audit_log (BEFORE execution)         â”‚      â”‚
â”‚  â”‚    â†“                                            â”‚      â”‚
â”‚  â”‚ 7. Execute (RobotJS, etc.)                     â”‚      â”‚
â”‚  â”‚    â†“                                            â”‚      â”‚
â”‚  â”‚ 8. Return result to UI                         â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Network & Communication Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 NETWORK COMMUNICATION                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  INTERNET                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  LLM APIs (HTTPS)                                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ api.anthropic.com (Claude)                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ generativelanguage.googleapis.com (Gemini)       â”‚  â”‚
â”‚  â”‚  â”œâ”€ api.groq.com (Groq)                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ api.openai.com (GPT/Whisper)                    â”‚  â”‚
â”‚  â”‚  â””â”€ [ALL use safeStorage encrypted keys]            â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  Search APIs (HTTPS)                                â”‚  â”‚
â”‚  â”‚  â”œâ”€ api.search.brave.com                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ api.tavily.com                                  â”‚  â”‚
â”‚  â”‚  â””â”€ serpapi.com                                     â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  External Services (HTTPS + OAuth)                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ gmail.googleapis.com (Gmail MCP)                â”‚  â”‚
â”‚  â”‚  â”œâ”€ api.github.com (GitHub MCP)                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ api.slack.com (Slack MCP)                       â”‚  â”‚
â”‚  â”‚  â””â”€ api.notion.com (Notion MCP)                     â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  Vector DB (Local + Remote hybrid)                  â”‚  â”‚
â”‚  â”‚  â””â”€ LanceDB (local SQLite)                          â”‚  â”‚
â”‚  â”‚      Can optionally sync to cloud LanceDB           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â†‘ (HTTPS, encrypted, rate-limited)                â”‚
â”‚                                                              â”‚
â”‚  LOCAL NETWORK                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Electron Desktop â†” Flutter Mobile                  â”‚  â”‚
â”‚  â”‚  WebSocket @ 127.0.0.1:9876 (localhost)             â”‚  â”‚
â”‚  â”‚  OR                                                  â”‚  â”‚
â”‚  â”‚  WebSocket @ 192.168.x.x:9876 (local Wi-Fi)         â”‚  â”‚
â”‚  â”‚  â”œâ”€ Auth: HMAC SHA-256 (rotating secret)            â”‚  â”‚
â”‚  â”‚  â”œâ”€ Payload: JSON (not encrypted in transit)        â”‚  â”‚
â”‚  â”‚  â””â”€ Events: ai:chat, ocr:click, screen:describe    â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  File System (Local)                                â”‚  â”‚
â”‚  â”‚  â”œâ”€ app.getPath('userData')/comet-*                 â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ comet-permissions.db (SQLite)               â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ rag-vectors/ (LanceDB)                       â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ workflows/ (JSON)                            â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ settings.json (electron-store)               â”‚  â”‚
â”‚  â”‚  â””â”€ OS Keychain (API keys via safeStorage)          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  OS LEVEL                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Native APIs (Electron modules)                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ desktopCapturer (screenshot)                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ ipcMain/ipcRenderer (inter-process comms)       â”‚  â”‚
â”‚  â”‚  â”œâ”€ globalShortcut (hotkeys)                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ notification (toast alerts)                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ dialog (file picker, message boxes)             â”‚  â”‚
â”‚  â”‚  â””â”€ shell (open URLs, run commands)                 â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  RobotJS                                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ mouse.moveMouse(x, y)                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ mouse.mouseClick()                              â”‚  â”‚
â”‚  â”‚  â”œâ”€ keyboard.typeString()                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ keyboard.keyTap()                               â”‚  â”‚
â”‚  â”‚  â””â”€ screen.getScreenSize()                          â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  Child Process                                      â”‚  â”‚
â”‚  â”‚  â””â”€ exec() for native commands (AppleScript, etc.)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ZUSTAND STATE (useAppStore)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  store.tabs                                              â”‚
â”‚  â”œâ”€ activeTabId: string                                 â”‚
â”‚  â”œâ”€ tabs: [                                             â”‚
â”‚  â”‚  {id, url, title, favicon, loading, history}        â”‚
â”‚  â”‚ ]                                                    â”‚
â”‚  â””â”€ methods: addTab, closeTab, navigateTab, etc.       â”‚
â”‚                                                            â”‚
â”‚  store.user                                              â”‚
â”‚  â”œâ”€ uid: string                                         â”‚
â”‚  â”œâ”€ email: string                                       â”‚
â”‚  â”œâ”€ displayName: string                                â”‚
â”‚  â”œâ”€ photoURL: string                                   â”‚
â”‚  â””â”€ isAuthenticated: boolean                           â”‚
â”‚                                                            â”‚
â”‚  store.ai                                                â”‚
â”‚  â”œâ”€ selectedModel: string                              â”‚
â”‚  â”œâ”€ selectedProvider: 'gemini'|'groq'|'openai'|'claude'â”‚
â”‚  â”œâ”€ chatHistory: [{role, content}]                     â”‚
â”‚  â””â”€ isLoading: boolean                                 â”‚
â”‚                                                            â”‚
â”‚  store.ui                                                â”‚
â”‚  â”œâ”€ darkMode: boolean                                  â”‚
â”‚  â”œâ”€ sidebarOpen: boolean                               â”‚
â”‚  â”œâ”€ settingsOpen: boolean                              â”‚
â”‚  â”œâ”€ activeView: 'browser'|'settings'|'plugins'|...     â”‚
â”‚  â””â”€ notifications: [{id, message, type, duration}]     â”‚
â”‚                                                            â”‚
â”‚  store.search                                            â”‚
â”‚  â”œâ”€ lastQuery: string                                  â”‚
â”‚  â”œâ”€ searchResults: [{title, url, snippet}]            â”‚
â”‚  â””â”€ selectedEngine: 'google'|'bing'|'duckduckgo'...   â”‚
â”‚                                                            â”‚
â”‚  PERSIST (electron-store)                              â”‚
â”‚  â””â”€ Save to localStorage on change:                   â”‚
â”‚     â”œâ”€ user (if authenticated)                        â”‚
â”‚     â”œâ”€ ui preferences                                 â”‚
â”‚     â”œâ”€ search engine                                  â”‚
â”‚     â”œâ”€ tab list                                       â”‚
â”‚     â””â”€ bookmarks                                      â”‚
â”‚                                                            â”‚
â”‚  HYDRATE (on app start)                                â”‚
â”‚  â””â”€ Load persisted state from:                         â”‚
â”‚     â”œâ”€ SQLite (history, bookmarks)                     â”‚
â”‚     â”œâ”€ electron-store (settings, user)                 â”‚
â”‚     â””â”€ IndexedDB (if web app fallback)                â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling & Recovery

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             ERROR HANDLING STRATEGY                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. LLM SERVICE ERRORS                                      â”‚
â”‚     â”œâ”€ Timeout (> 30s)                                     â”‚
â”‚     â”‚  â””â”€ Fall back to next provider (Groq â†’ Claude)      â”‚
â”‚     â”œâ”€ Rate limit (429)                                    â”‚
â”‚     â”‚  â””â”€ Exponential backoff + queue request              â”‚
â”‚     â”œâ”€ Auth error (401)                                    â”‚
â”‚     â”‚  â””â”€ Prompt user to add/refresh API key               â”‚
â”‚     â””â”€ Network error                                       â”‚
â”‚        â””â”€ Show "offline" badge, queue message              â”‚
â”‚                                                              â”‚
â”‚  2. ROBOT SERVICE ERRORS                                    â”‚
â”‚     â”œâ”€ Coordinates out of bounds                           â”‚
â”‚     â”‚  â””â”€ Abort, show error + offer screen map             â”‚
â”‚     â”œâ”€ Permission denied                                   â”‚
â”‚     â”‚  â””â”€ Redirect to permissions settings                 â”‚
â”‚     â”œâ”€ Action timeout (> 10s)                              â”‚
â”‚     â”‚  â””â”€ Emergency kill switch triggered                  â”‚
â”‚     â””â”€ Unexpected robot.js crash                           â”‚
â”‚        â””â”€ Restart robot module, alert user                â”‚
â”‚                                                              â”‚
â”‚  3. DATABASE ERRORS                                         â”‚
â”‚     â”œâ”€ SQLite corruption                                   â”‚
â”‚     â”‚  â””â”€ Backup existing DB, create new                  â”‚
â”‚     â”œâ”€ Disk full                                           â”‚
â”‚     â”‚  â””â”€ Clean old history, notify user                  â”‚
â”‚     â”œâ”€ Migration failure                                   â”‚
â”‚     â”‚  â””â”€ Rollback, log issue                             â”‚
â”‚     â””â”€ Encryption key mismatch                             â”‚
â”‚        â””â”€ Prompt user to reset (data loss)                â”‚
â”‚                                                              â”‚
â”‚  4. NETWORK ERRORS                                          â”‚
â”‚     â”œâ”€ No internet                                         â”‚
â”‚     â”‚  â””â”€ Cache results, show "offline" UI                â”‚
â”‚     â”œâ”€ DNS failure                                         â”‚
â”‚     â”‚  â””â”€ Show alternative DNS options                    â”‚
â”‚     â””â”€ SSL certificate error                              â”‚
â”‚        â””â”€ Show warning, offer to proceed (risky)          â”‚
â”‚                                                              â”‚
â”‚  5. UI ERRORS                                               â”‚
â”‚     â”œâ”€ Render error (React crash)                          â”‚
â”‚     â”‚  â””â”€ Error boundary catches, shows fallback UI        â”‚
â”‚     â”œâ”€ Async action timeout                                â”‚
â”‚     â”‚  â””â”€ Show spinner â†’ timeout message                   â”‚
â”‚     â””â”€ Navigation error                                    â”‚
â”‚        â””â”€ Go back + show error detail                      â”‚
â”‚                                                              â”‚
â”‚  GLOBAL ERROR HANDLER                                       â”‚
â”‚  â”œâ”€ Catch all uncaught errors                             â”‚
â”‚  â”œâ”€ Log to audit trail                                    â”‚
â”‚  â”œâ”€ Show user-friendly message                            â”‚
â”‚  â”œâ”€ Optional: send to error tracking (Sentry)             â”‚
â”‚  â””â”€ Graceful degradation:                                 â”‚
â”‚     â”œâ”€ If AI fails: basic browser still works             â”‚
â”‚     â”œâ”€ If OCR fails: keyboard/menu navigation still works  â”‚
â”‚     â”œâ”€ If robot fails: manual UI still works              â”‚
â”‚     â””â”€ If DB fails: use in-memory cache                   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Audit Trail Example

```
Audit Log (SQLite audit_log table)
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚id  â”‚action_type   â”‚timestamp   â”‚details         â”‚hmac_sig  â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚1   â”‚robot.click   â”‚1708945232  â”‚{               â”‚abc12..   â”‚
â”‚    â”‚              â”‚000         â”‚  x:923,        â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  y:442,        â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  reason:       â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  "Click Pay",  â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  target_app:   â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  "Chrome",     â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  confirmed:    â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  true          â”‚          â”‚
â”‚    â”‚              â”‚            â”‚}               â”‚          â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚2   â”‚ai.chat       â”‚1708945235  â”‚{               â”‚def45..   â”‚
â”‚    â”‚              â”‚500         â”‚  model:        â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  "gemini-2.5..",â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  message:      â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  "Search AI... â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  tokens_in: 34,â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  tokens_out:   â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  245           â”‚          â”‚
â”‚    â”‚              â”‚            â”‚}               â”‚          â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚3   â”‚permission.   â”‚1708945240  â”‚{               â”‚ghi78..   â”‚
â”‚    â”‚grant         â”‚000         â”‚  key:          â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  "robot",      â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  level:        â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  "interact",   â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  expires_in:   â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  28800000      â”‚          â”‚
â”‚    â”‚              â”‚            â”‚}               â”‚          â”‚
â”‚    â”‚              â”‚            â”‚                â”‚          â”‚
â”‚    â”‚              â”‚            â”‚  (8 hours)     â”‚          â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AUDIT LOG VERIFICATION:
 â€¢ Each entry signed with HMAC-SHA256(entry || secret_key)
 â€¢ Secret key stored in Electron safeStorage
 â€¢ Log is append-only (no UPDATE/DELETE)
 â€¢ Tamper detection: if signature doesn't match, alert user
 â€¢ Export: user can download full audit CSV for compliance
```

---

## Deployment & Build Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           GITHUB ACTIONS BUILD PIPELINE                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  TRIGGER: Push to main, or version tag (v2.0.0)           â”‚
â”‚                                                              â”‚
â”‚  BUILD JOB: Build All Platforms                           â”‚
â”‚  â”œâ”€ Node.js 20 setup                                      â”‚
â”‚  â”œâ”€ npm install                                           â”‚
â”‚  â”œâ”€ npm run build (Next.js)                               â”‚
â”‚  â”œâ”€ Rebuild native modules (robotjs, better-sqlite3)      â”‚
â”‚  â”‚  â””â”€ electron-rebuild for current Electron version      â”‚
â”‚  â””â”€ electron-builder for each platform:                   â”‚
â”‚     â”œâ”€ Windows:                                           â”‚
â”‚     â”‚  â””â”€ npm run dist:win                                â”‚
â”‚     â”‚     â†’ Comet\ Browser\ Setup\ 2.0.0.exe             â”‚
â”‚     â”œâ”€ macOS:                                             â”‚
â”‚     â”‚  â””â”€ npm run dist:mac                                â”‚
â”‚     â”‚     â†’ Comet\ Browser\ 2.0.0.dmg                    â”‚
â”‚     â””â”€ Linux:                                             â”‚
â”‚        â””â”€ npm run dist:linux                              â”‚
â”‚           â†’ comet-browser-2.0.0.AppImage                 â”‚
â”‚                                                              â”‚
â”‚  ANDROID BUILD JOB                                         â”‚
â”‚  â”œâ”€ Flutter setup                                         â”‚
â”‚  â”œâ”€ cd CometBrowserMobile/comet_ai                        â”‚
â”‚  â”œâ”€ flutter build apk --release                           â”‚
â”‚  â”‚  â†’ app-release.apk                                     â”‚
â”‚  â”œâ”€ Sign APK with keystore                                â”‚
â”‚  â”‚  â””â”€ jarsigner -keystore comet.jks app-release.apk      â”‚
â”‚  â””â”€ Upload to GitHub Releases                             â”‚
â”‚                                                              â”‚
â”‚  iOS BUILD JOB                                             â”‚
â”‚  â”œâ”€ macOS runner only                                     â”‚
â”‚  â”œâ”€ Flutter setup                                         â”‚
â”‚  â”œâ”€ flutter build ios --release --no-codesign             â”‚
â”‚  â”‚  â†’ build/ios/iphoneos/Runner.app                       â”‚
â”‚  â”œâ”€ Create .ipa with xcode                                â”‚
â”‚  â””â”€ Upload to GitHub Releases                             â”‚
â”‚                                                              â”‚
â”‚  TEST JOBS (parallel)                                      â”‚
â”‚  â”œâ”€ Unit tests: npm test                                  â”‚
â”‚  â”œâ”€ Lint: npm run lint                                    â”‚
â”‚  â”œâ”€ Type check: tsc --noEmit                              â”‚
â”‚  â””â”€ Build verification: verify-build.js                   â”‚
â”‚                                                              â”‚
â”‚  ARTIFACTS                                                 â”‚
â”‚  â”œâ”€ Windows: comet-browser-win-installer                 â”‚
â”‚  â”œâ”€ macOS: comet-browser-mac-dmg                         â”‚
â”‚  â”œâ”€ Linux: comet-browser-linux-appimage                  â”‚
â”‚  â”œâ”€ Android: comet-browser-android-apk                   â”‚
â”‚  â””â”€ iOS: comet-browser-ios-ipa                           â”‚
â”‚                                                              â”‚
â”‚  RELEASE                                                   â”‚
â”‚  â”œâ”€ Create GitHub Release                                â”‚
â”‚  â”œâ”€ Attach all artifacts                                  â”‚
â”‚  â”œâ”€ Generate release notes                                â”‚
â”‚  â””â”€ Update auto-updater feed (Windows/macOS)              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Performance Optimization Strategies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PERFORMANCE OPTIMIZATION CHECKLIST                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  STARTUP (Target: < 3s)                                    â”‚
â”‚  â”œâ”€ [ ] Lazy-load AI providers (on first use)             â”‚
â”‚  â”œâ”€ [ ] Defer LanceDB init until RAG first queried        â”‚
â”‚  â”œâ”€ [ ] Preload critical Tesseract model in background    â”‚
â”‚  â”œâ”€ [ ] Cache emoticon/icon data                          â”‚
â”‚  â””â”€ [ ] Use code splitting (Next.js automatic)            â”‚
â”‚                                                              â”‚
â”‚  RENDERING (Target: 60 FPS)                               â”‚
â”‚  â”œâ”€ [ ] Virtualize chat history list (windowing)          â”‚
â”‚  â”œâ”€ [ ] Debounce AI response streaming (100ms)            â”‚
â”‚  â”œâ”€ [ ] Memoize expensive components (React.memo)         â”‚
â”‚  â”œâ”€ [ ] Use CSS transitions (not JS animations)           â”‚
â”‚  â””â”€ [ ] Remove unused Tailwind classes (purge)            â”‚
â”‚                                                              â”‚
â”‚  AI/LLM (Target: < 2s response)                           â”‚
â”‚  â”œâ”€ [ ] Use Groq for fast tasks (sub-100ms)              â”‚
â”‚  â”œâ”€ [ ] Implement request batching                        â”‚
â”‚  â”œâ”€ [ ] Cache embeddings (don't re-embed same text)       â”‚
â”‚  â”œâ”€ [ ] Stream responses (don't wait for full answer)     â”‚
â”‚  â””â”€ [ ] Rate limit requests (queue if overloaded)         â”‚
â”‚                                                              â”‚
â”‚  DATABASE (Target: < 500ms query)                         â”‚
â”‚  â”œâ”€ [ ] Index SQLite on history.timestamp, bookmarks.id   â”‚
â”‚  â”œâ”€ [ ] Vacuum DB weekly (VACUUM command)                 â”‚
â”‚  â”œâ”€ [ ] Paginate results (LIMIT 50 + offset)              â”‚
â”‚  â”œâ”€ [ ] LanceDB: keep vector dimension low (384)          â”‚
â”‚  â””â”€ [ ] Archive old history (move to archive table)       â”‚
â”‚                                                              â”‚
â”‚  OCR/SCREEN (Target: < 2s capture+OCR)                   â”‚
â”‚  â”œâ”€ [ ] Preprocess image (sharp) before OCR               â”‚
â”‚  â”œâ”€ [ ] Cache OCR results for same screenshot             â”‚
â”‚  â”œâ”€ [ ] Limit OCR to visible area (not full screen)       â”‚
â”‚  â”œâ”€ [ ] Use 2Ã— upscale only for low-DPI displays          â”‚
â”‚  â””â”€ [ ] Worker thread for OCR (non-blocking)              â”‚
â”‚                                                              â”‚
â”‚  MEMORY (Target: < 500MB idle, < 1GB with 10 tabs)        â”‚
â”‚  â”œâ”€ [ ] Unload background tabs' BrowserView               â”‚
â”‚  â”œâ”€ [ ] Clear chat history after N days                   â”‚
â”‚  â”œâ”€ [ ] Limit LanceDB cache size                          â”‚
â”‚  â”œâ”€ [ ] Use weak references for event listeners           â”‚
â”‚  â””â”€ [ ] Profile with DevTools â†’ chrome://inspect          â”‚
â”‚                                                              â”‚
â”‚  NETWORK (Target: < 1s for LLM, < 2s for web search)    â”‚
â”‚  â”œâ”€ [ ] Connection pooling (HTTP keep-alive)              â”‚
â”‚  â”œâ”€ [ ] DNS prefetching for known APIs                    â”‚
â”‚  â”œâ”€ [ ] Gzip compression for request bodies               â”‚
â”‚  â”œâ”€ [ ] Request timeout (30s max)                         â”‚
â”‚  â””â”€ [ ] CDN for static assets (if applicable)              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**End of Technical Architecture Document**

